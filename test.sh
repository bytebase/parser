#!/bin/bash

# List of all available parsers
ALL_PARSERS="redshift"
# Add more parsers here as they are added to the repository
# ALL_PARSERS="redshift mysql postgresql"

CHANGED_FILES=".github/workflows/tests.yml .gitignore go.mod go.sum redshift/CLAUDE.md redshift/Makefile redshift/README.md redshift/RedshiftLexer.g4 redshift/RedshiftLexer.interp redshift/RedshiftLexer.tokens redshift/RedshiftParser.g4 redshift/RedshiftParser.interp redshift/RedshiftParser.tokens redshift/builtin_function.go redshift/examples/redshift/abort.sql redshift/examples/redshift/abort_command.sql redshift/examples/redshift/alter_database.sql redshift/examples/redshift/alter_datashare.sql redshift/examples/redshift/alter_default_privileges.sql redshift/examples/redshift/alter_external_schema.sql redshift/examples/redshift/alter_external_view.sql redshift/examples/redshift/alter_function.sql redshift/examples/redshift/alter_group.sql redshift/examples/redshift/alter_identity_provider.sql redshift/examples/redshift/alter_masking_policy.sql redshift/examples/redshift/alter_materialized_view.sql redshift/examples/redshift/alter_procedure.sql redshift/examples/redshift/alter_rls_policy.sql redshift/examples/redshift/alter_role.sql redshift/examples/redshift/alter_schema.sql redshift/examples/redshift/alter_system.sql redshift/examples/redshift/alter_table.sql redshift/examples/redshift/alter_table_append.sql redshift/examples/redshift/alter_user.sql redshift/examples/redshift/analyze.sql redshift/examples/redshift/analyze_compression.sql redshift/examples/redshift/attach_masking_policy.sql redshift/examples/redshift/attach_rls_policy.sql redshift/examples/redshift/begin.sql redshift/examples/redshift/c_create_commands.sql redshift/examples/redshift/call.sql redshift/examples/redshift/cancel.sql redshift/examples/redshift/close.sql redshift/examples/redshift/comment.sql redshift/examples/redshift/commit.sql redshift/examples/redshift/copy.sql redshift/examples/redshift/create_database.sql redshift/examples/redshift/create_datashare.sql redshift/examples/redshift/create_external_function.sql redshift/examples/redshift/create_external_model.sql redshift/examples/redshift/create_external_schema.sql redshift/examples/redshift/create_external_table.sql redshift/examples/redshift/create_external_view.sql redshift/examples/redshift/create_function.sql redshift/examples/redshift/create_group.sql redshift/examples/redshift/create_identity_provider.sql redshift/examples/redshift/create_library.sql redshift/examples/redshift/create_masking_policy.sql redshift/examples/redshift/create_materialized_view.sql redshift/examples/redshift/create_model.sql redshift/examples/redshift/create_procedure.sql redshift/examples/redshift/create_rls_policy.sql redshift/examples/redshift/create_role.sql redshift/examples/redshift/create_schema.sql redshift/examples/redshift/create_table.sql redshift/examples/redshift/create_table_as.sql redshift/examples/redshift/create_user.sql redshift/examples/redshift/create_view.sql redshift/examples/redshift/deallocate.sql redshift/examples/redshift/declare.sql redshift/examples/redshift/delete.sql redshift/examples/redshift/desc_datashare.sql redshift/examples/redshift/desc_identity_provider.sql redshift/examples/redshift/detach_masking_policy.sql redshift/examples/redshift/detach_rls_policy.sql redshift/examples/redshift/drop_database.sql redshift/examples/redshift/drop_datashare.sql redshift/examples/redshift/drop_external_view.sql redshift/examples/redshift/drop_function.sql redshift/examples/redshift/drop_group.sql redshift/examples/redshift/drop_identity_provider.sql redshift/examples/redshift/drop_library.sql redshift/examples/redshift/drop_masking_policy.sql redshift/examples/redshift/drop_materialized_view.sql redshift/examples/redshift/drop_model.sql redshift/examples/redshift/drop_procedure.sql redshift/examples/redshift/drop_rls_policy.sql redshift/examples/redshift/drop_role.sql redshift/examples/redshift/drop_schema.sql redshift/examples/redshift/drop_table.sql redshift/examples/redshift/drop_user.sql redshift/examples/redshift/drop_view.sql redshift/examples/redshift/end.sql redshift/examples/redshift/execute.sql redshift/examples/redshift/explain.sql redshift/examples/redshift/fetch.sql redshift/examples/redshift/grant.sql redshift/examples/redshift/insert.sql redshift/examples/redshift/insert_external_table.sql redshift/examples/redshift/lock.sql redshift/examples/redshift/merge.sql redshift/examples/redshift/prepare.sql redshift/examples/redshift/refresh_materialized_view.sql redshift/examples/redshift/reset.sql redshift/examples/redshift/revoke.sql redshift/examples/redshift/rollback.sql redshift/examples/redshift/select.sql redshift/examples/redshift/select_into.sql redshift/examples/redshift/set.sql redshift/examples/redshift/set_session_authorization.sql redshift/examples/redshift/set_session_characteristics.sql redshift/examples/redshift/show.sql redshift/examples/redshift/show_columns.sql redshift/examples/redshift/show_databases.sql redshift/examples/redshift/show_datashares.sql redshift/examples/redshift/show_external_table.sql redshift/examples/redshift/show_grants.sql redshift/examples/redshift/show_model.sql redshift/examples/redshift/show_procedure.sql redshift/examples/redshift/show_schemas.sql redshift/examples/redshift/show_table.sql redshift/examples/redshift/show_tables.sql redshift/examples/redshift/show_view.sql redshift/examples/redshift/start_transaction.sql redshift/examples/redshift/truncate.sql redshift/examples/redshift/unload.sql redshift/examples/redshift/update.sql redshift/examples/redshift/use.sql redshift/examples/redshift/vacuum.sql redshift/keywords.go redshift/parser_test.go redshift/redshift_lexer.go redshift/redshift_lexer_base.go redshift/redshift_parse_error.go redshift/redshift_parser.go redshift/redshift_parser_base.go redshift/redshift_parser_error_listener.go redshift/redshiftparser_base_listener.go redshift/redshiftparser_base_visitor.go redshift/redshiftparser_listener.go redshift/redshiftparser_visitor.go redshift/string_stack.go"
echo "Debug: Changed files: $CHANGED_FILES"
CHANGED_PARSERS=""

for parser in $ALL_PARSERS; do
  echo "Checking changes for parser: $parser"
  if echo "$CHANGED_FILES" | grep -q "^$parser/"; then
    echo "True - $parser has changes."
    if [ -z "$CHANGED_PARSERS" ]; then
      CHANGED_PARSERS="\"$parser\""
    else
      CHANGED_PARSERS="$CHANGED_PARSERS,\"$parser\""
    fi
  fi
done
